<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Galaxy Heart ‚Üí RGB Tree</title>
    <style>
      html,
      body {
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: radial-gradient(circle at bottom, #0b1d3a, #000);
        font-family: "Segoe UI", sans-serif;
      }
      canvas {
        position: absolute;
        top: 0;
        left: 0;
      }

      #startBtn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 18px 44px;
        font-size: 20px;
        border-radius: 40px;
        border: none;
        background: #4facfe;
        color: white;
        cursor: pointer;
        box-shadow: 0 0 30px #7fd7ff;
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        50% {
          transform: translate(-50%, -50%) scale(1.1);
        }
      }

      #text {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 440px;
        height: 440px;
        margin: -220px 0 0 -220px;
        pointer-events: none;
      }
      #text span {
        position: absolute;
        left: 50%;
        top: 0;
        transform-origin: 0 220px;
        font-size: 22px;
        color: #ff9adf;
        text-shadow: 0 0 20px #ffb6d9;
      }

      #imgContainer {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none;
        grid-template-columns: repeat(2, 120px);
        grid-template-rows: repeat(2, 120px);
        gap: 20px;
      }
      #imgContainer img {
        width: 100px;
        height: 100px;
        border-radius: 15px;
        cursor: pointer;
        transition: 0.4s;
        border: 4px solid transparent;
      }
      #imgContainer img.zoomed {
        width: 300px;
        height: 300px;
        transform: scale(1.4);
        z-index: 10;
        border-radius: 25px;
      }
      #imgContainer img.hidden {
        opacity: 0;
        pointer-events: none;
      }
    </style>
  </head>

  <body>
    <canvas id="cv"></canvas>

    <button id="startBtn">
      üíô B·∫ÆT ƒê·∫¶U üíô<br />
      <small>B1: B·∫Øt ƒë·∫ßu<br />B2: Chu·ªôt ph·∫£i<br />B3: Chu·ªôt tr√°i</small>
    </button>

    <div id="text"></div>
    <div id="imgContainer"></div>

    <audio id="music" loop>
      <source src="./piano2.mp3" type="audio/mpeg" />
    </audio>

    <script>
      const cv = document.getElementById("cv"),
        ctx = cv.getContext("2d"),
        btn = document.getElementById("startBtn"),
        music = document.getElementById("music"),
        textBox = document.getElementById("text"),
        imgContainer = document.getElementById("imgContainer");

      let W,
        H,
        run = false,
        formed = false,
        treeDone = false;
      let dots = [],
        snow = [],
        treeParticles = [];
      let zoomedImg = null;
      const DOT_COUNT = 1000;

      function resize() {
        W = cv.width = innerWidth;
        H = cv.height = innerHeight;
      }
      resize();
      onresize = resize;

      /* STARS BACKGROUND */
      let stars = [...Array(200)].map(() => ({
        x: Math.random() * W,
        y: Math.random() * H,
        r: Math.random() * 1.5,
        a: Math.random(),
      }));

      /* HEART */
      function heart(t, s = 1) {
        return {
          x: s * 16 * Math.sin(t) ** 3,
          y:
            s *
            -(
              13 * Math.cos(t) -
              5 * Math.cos(2 * t) -
              2 * Math.cos(3 * t) -
              Math.cos(4 * t)
            ),
        };
      }
      function drawMiniHeart(x, y, sz, a, col) {
        ctx.save();
        ctx.translate(x, y);
        ctx.scale(sz, sz);
        ctx.globalAlpha = a;
        ctx.fillStyle = col;
        ctx.beginPath();
        for (let t = 0; t <= Math.PI * 2; t += 0.2) {
          let p = heart(t);
          ctx.lineTo(p.x, p.y);
        }
        ctx.fill();
        ctx.restore();
      }

      /* INIT HEART */
      function initDots() {
        dots = [];
        for (let i = 0; i < DOT_COUNT; i++) {
          let t = Math.random() * Math.PI * 2,
            p = heart(t, 12);
          dots.push({
            angle: Math.random() * Math.PI * 2,
            radius: 600 + Math.random() * 300,
            tx: p.x,
            ty: p.y,
          });
        }
      }
      initDots();

      /* LEFT CLICK */
      cv.onclick = () => {
        if (!formed) return;
        dots.forEach((d) => {
          snow.push({
            x: W / 2 + d.tx,
            y: H / 2 - d.ty,
            vx: (Math.random() - 0.5) * 2,
            vy: Math.random() * 2 + 1,
            a: 1,
            color: "#ff9ac4",
          });
        });
        dots = [];
        formed = false;
        showImages();
      };

      /* RIGHT CLICK ‚Üí TREE */
      cv.oncontextmenu = (e) => {
        e.preventDefault();
        if (!formed) return;

        treeParticles = [];
        treeDone = false;

        const levels = 10;
        const baseY = H - 80;

        for (let l = 0; l < levels; l++) {
          let width = (levels - l) * 14;
          let count = (levels - l) * 7;
          for (let i = 0; i < count; i++) {
            let tx = W / 2 + (i - count / 2) * width;
            let ty = baseY - l * 35;
            treeParticles.push({
              cx: W / 2,
              cy: H / 2,
              angle: Math.random() * Math.PI * 2,
              radius: Math.random() * Math.max(W, H),
              tx,
              ty,
              hue: l * 30,
              a: 1,
            });
          }
        }
      };

      /* IMAGES */
      const imgColors = ["#ff004c", "#00ffcc", "#00aaff", "#cc00ff"];
      function showImages() {
        imgContainer.innerHTML = "";
        imgContainer.style.display = "grid";
        ["./d.jfif", "./k.jfif", "./h.jfif", "./q.jfif"].forEach((src, i) => {
          let im = document.createElement("img");
          im.src = src;
          im.style.boxShadow = `0 0 20px ${imgColors[i]}`;
          im.onclick = () => {
            if (zoomedImg === im) {
              im.classList.remove("zoomed");
              document
                .querySelectorAll("#imgContainer img")
                .forEach((x) => x.classList.remove("hidden"));
              im.style.borderColor = "transparent";
              zoomedImg = null;
            } else {
              document
                .querySelectorAll("#imgContainer img")
                .forEach((x) => x !== im && x.classList.add("hidden"));
              im.classList.add("zoomed");
              im.style.borderColor = imgColors[i];
              im.style.boxShadow = `0 0 40px ${imgColors[i]}`;
              zoomedImg = im;
            }
          };
          imgContainer.appendChild(im);
        });
      }

      /* DRAW LOOP */
      function draw() {
        if (!run) return;
        ctx.clearRect(0, 0, W, H);

        /* stars */
        stars.forEach((s) => {
          ctx.globalAlpha = s.a;
          ctx.fillStyle = "#fff";
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
          ctx.fill();
        });
        ctx.globalAlpha = 1;

        /* HEART */
        if (dots.length) {
          ctx.save();
          ctx.translate(W / 2, H / 2);
          dots.forEach((d) => {
            d.angle += 0.02;
            d.radius *= 0.992;
            let x = Math.cos(d.angle) * d.radius + d.tx * (1 - d.radius / 600);
            let y = Math.sin(d.angle) * d.radius + d.ty * (1 - d.radius / 600);
            drawMiniHeart(x, y, 0.06, 1 - d.radius / 900, "#6fdcff");
          });
          ctx.restore();
          if (dots.every((d) => d.radius < 30)) formed = true;
        }

        /* SNOW */
        snow.forEach((s) => {
          drawMiniHeart(s.x, s.y, 0.08, s.a, s.color || "#fff");
          s.x += s.vx;
          s.y += s.vy;
          s.a -= 0.01;
        });
        snow = snow.filter((s) => s.a > 0);

        /* TREE */
        treeParticles.forEach((p) => {
          p.angle += 0.05;
          p.radius *= 0.95;
          let sx = p.cx + Math.cos(p.angle) * p.radius;
          let sy = p.cy + Math.sin(p.angle) * p.radius;
          p.x = sx + (p.tx - sx) * 0.1;
          p.y = sy + (p.ty - sy) * 0.1;
          let col = `hsl(${p.hue},100%,60%)`;
          ctx.shadowColor = col;
          ctx.shadowBlur = 20;
          drawMiniHeart(p.x, p.y, 0.4, p.a, col);
          p.a *= 0.99;
          if (p.radius < 15) treeDone = true;
        });

        /* STAR TOP */
        if (treeDone) {
          ctx.save();
          ctx.translate(W / 2, H - 80 - 10 * 35 - 20);
          ctx.rotate(Date.now() / 500);
          ctx.fillStyle = "#fff200";
          ctx.shadowColor = "#fff";
          ctx.shadowBlur = 40;
          ctx.beginPath();
          for (let i = 0; i < 5; i++) {
            ctx.lineTo(0, -30);
            ctx.rotate(Math.PI / 5);
            ctx.lineTo(0, -12);
            ctx.rotate(Math.PI / 5);
          }
          ctx.fill();
          ctx.restore();

          if (Math.random() < 0.3) {
            snow.push({
              x: Math.random() * W,
              y: -10,
              vx: 0,
              vy: 1 + Math.random(),
              a: 1,
              color: "#fff",
            });
          }
        }

        requestAnimationFrame(draw);
      }

      /* START */
      btn.onclick = () => {
        btn.style.display = "none";
        run = true;
        music.play().catch(() => {});
        draw();
        showText();
      };

      /* TEXT */
      function showText() {
        textBox.innerHTML = "";
        const txt = " See you ‚ú® Thanks and Bye ‚ú® ";
        const step = 360 / txt.length;
        txt.split("").forEach((c, i) => {
          let s = document.createElement("span");
          s.innerText = c;
          s.style.transform = `rotate(${
            i * step
          }deg) translateY(-220px) scale(.5)`;
          s.style.opacity = 0;
          s.style.transition = "1s";
          textBox.appendChild(s);
          setTimeout(() => {
            s.style.opacity = 1;
            s.style.transform = `rotate(${
              i * step
            }deg) translateY(-220px) scale(1)`;
          }, i * 80);
        });
        let a = 0;
        (function rot() {
          a += 0.2;
          textBox.style.transform = `rotate(${a}deg)`;
          requestAnimationFrame(rot);
        })();
      }
    </script>
  </body>
</html>
